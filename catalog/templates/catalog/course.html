{% extends "base.html" %}

{% load humanize %}
{% load has_perm_on %}

{% block title %}{{ course.slug|upper }} {{ course.name }}{% endblock %}

{% block content %}

<div data-controller="course-filter" style="display: grid; grid-template-columns: 1fr 65% 1fr 25% 1fr;margin-top: 1.5em;">
    <div style="grid-column-start: 2;">
        <h1 style="margin-left: 2rem;font-family: Titillium Web; font-style: normal; font-weight: normal; font-size: 32px; line-height: 49px;">
            {{ course.slug|upper }} {{ course.name }}
            {# TODO conditionnal green check #}
            {# if request.user.is_following course #}
            <i class="fi-check green"></i>
            {# endif #}
            {% if followers_count > 1 %}
            <small>{{followers_count}} personnes sont abonnées à ce cours.</small>
            {% endif %}
        </h1>
        <div class="deck">
            {% for document in documents %}
            <div
              class="card"
              data-course-filter-target="filterable"
              data-filter-key='{{document.name}}'
              data-tags="{{document.tags.all|join:' '}}"
            >
                <div class="card-like">
                  <a class="like" href="#like">
                      <i class="fas fa-thumbs-up" style="grid-row-start:1"></i>
                      <span style="font-size: 24px;font-family: Titillium Web;font-weight: normal;margin-left:0.25em">{{document.upvotes}}</span>
                  </a>
                  <a class="dislike" href="#dislike">
                      <i class="fas fa-thumbs-down" style="grid-row-start:2"></i>
                      <span style="font-size: 24px;font-family: Titillium Web;font-weight: normal;margin-left:0.25em">{{document.downvotes}}</span>
                  </a>
                </div>
                <div class="card-content">
                    <div class="card-title">
                        <a href="{% url 'document_show' document.pk %}">{{document.name}}</a>
                        <span>{{ document.user.name }}</span>
                    </div>
                    {% if document.description %}
                        <div class="card-comment">
                          {{ document.description|truncatechars:200 }}
                        </div>
                    {% endif %}
                    <div class="card-footers">
                        <span><i class="far fa-file"></i>{{ document.pages }} page{{ document.pages|pluralize }}</span>
                        <span><i class="far fa-clock"></i>{{ document.date|date:"d F Y" }}</span>
                        <div class="tags">
                          {% for kw in document.tags.all%}
                            <span
                               data-id="{{kw.id}}"
                               style="background-color: {{kw.color}}; color:white;"
                            >
                              {{kw}}
                            </span>
                          {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="delimiter">
            </div>
            {% empty %}
              <h3>Il n’y a encore rien dans ce cours…</h3>
              <p>Personne n’est encore passé ici on dirait.<br>
                Vous pourriez poser une question ou encore uploader un document en cliquant sur les boutons ci-dessus. </p>
            {% endfor %}

        </div>
    </div>

    <div class="aside">
        <div style="grid-row-start:1;text-align: center;white-space: nowrap">
            <a href="{% url 'document_put' course.slug %}" class="button green">
                <i class="fas fa-plus"></i>
                Uploader un fichier
            </a>
            {# TODO conditional button #}
            {# if request.user.is_following:course #}
            <a href="{% url 'leave_course' course.slug %}" class="button red">
                <i class="fas fa-times"></i> Se désabonner
            </a>
            {# else #}
            <a href="{% url 'join_course' course.slug %}" class="button blue">
                <i class="fas fa-check"></i> S’abonner au cours
            </a>
            {# endif #}
        </div>
        <div style="grid-row-start:2">
            <div style="border: 2px solid black;border-radius: 0.5rem;justify-content: center;align-content: center;">
                <i class="fas fa-search" style="margin: 0.5rem;"></i>
                <input
                  type="text" name="cours"
                  placeholder="Chercher avec le titre du fichier"
                  data-course-filter-target="query"
                  data-action="input->course-filter#filter"
                  style="border: none;text-align: center;outline: none;width:80%"
                >
            </div>
        </div>
        <div style="grid-row-start:3">
            <h1 style="font-weight: normal;">Filtres:</h1>
            <div style="margin:auto;padding-left: 1em;padding-right: 1em;text-align:center">
            {% for tag in tags %}
              <div class="ck-button">
                  <input
                    type="checkbox"
                    id="tag-{{tag.name}}"
                    data-tag-name="{{tag.name}}"
                    data-action="input->course-filter#filter"
                    data-course-filter-target="tag"
                  >
                  <label for="tag-{{tag.name}}" style="background-color:{{tag.color}};">
                    <span>{{tag.name}}</span>
                  </label>
              </div>
            {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
