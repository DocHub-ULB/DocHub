{% extends "skel.html" %}
{% load render_bundle from webpack_loader %}

{% load humanize %}
{% load custommardown %}
{% load activity_tags %}
{% load has_perm_on %}

{% block title %}{{ course.slug|upper }}{% endblock %}

{% block header %}
{% render_bundle 'courses' %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="large-12 columns">
    <h1 >
      {{ course.slug|upper }} {{ course.name }}
      {% if request.user|is_following:course %}
        <i class="fi-check green"></i>
      {% endif %}
      {% if followers_count > 1 %}
        <small>{{followers_count}} personnes sont abonnées à ce cours.</small>
      {% endif %}
    </h1>
    <div >
        <a href="{{ course.gehol_url }}" target="_blank" class="button radius tiny secondary right">
            <i class="fi-calendar"></i>
            Horaire sur GeHol
        </a>
        <a href="{% url 'document_put' course.slug %}" class="button radius tiny success">
            <i class="fi-plus"></i>
            Uploader un fichier
        </a>
        {% if request.user|is_following:course %}
          <a href="{% url 'leave_course' course.slug %}" class="button radius info tiny">
            <i class="fi-x"></i> Se désabonner
          </a>
        {% else %}
          <a href="{% url 'join_course' course.slug %}" class="button radius info tiny">
            <i class="fi-check"></i> S’abonner au cours
          </a>
        {% endif %}

    </div>



  </div>
</div>
<div class="row">
    <div class="large-12 medium-12 columns">
      <div class="tabs-content">
        <div class="content active" id="documents" data-controller="course-filter">
          <div>
             <div class="row course-top">
                <div class="column small-7">
                   <h4>Filtrer <small>par tag</small></h4>
                    <span class="radius label tag-item selectionable" style="border: 2px solid rgb(168, 177, 9); background-color: rgb(168, 177, 9); color: white;">
                      <input
                        type="checkbox"
                        data-tag-name="tp"
                        data-action="input->course-filter#filter"
                        data-course-filter-target="tag"
                      > tp
                    </span>
                    <span class="radius label tag-item selectionable" style="border: 2px solid rgb(181, 18, 163); background-color: rgb(181, 18, 163); color: white;">
                      <input
                        type="checkbox"
                        data-tag-name="examen"
                        data-action="input->course-filter#filter"
                        data-course-filter-target="tag"
                      > examen
                    </span>
                </div>
                <div class="column small-5">
                   <h4>Chercher <small>dans le titre</small></h4>
                   <input data-course-filter-target="query"
                      data-action="input->course-filter#filter"
                      type="text"
                    />
                </div>
             </div>
             <br>
             {% for document in documents %}
             <div
              class="row course-document"
              data-course-filter-target="filterable"
              data-filter-key='{{document.name}}'
              data-tags="{{document.tags.all|join:' '}}"
             >
                <div class="large-12 columns">
                   <div class="panel">
                      <div class="right">
                        <a href="/api/documents/62876/pdf/" title="Télécharger" class="radius label tiny secondary"><i class="fi-download dark-grey"></i> Télécharger</a>
                        <a href="/documents/62876/edit" title="Éditer" class="radius label tiny secondary"><i class="fi-pencil dark-grey"></i> Editer</a>
                        <a href="/documents/62876/reupload" class="radius label tiny secondary"><i class="fi-page-add dark-grey" title="Ré-uploader"></i> Ré-uploader</a></div>
                      <h5><a href="/documents/62876">{{document.name}}</a><small> par {{ document.user.name }}</small><br></h5>
                      {% if document.description %}
                        <p class="document-description">{{ document.description|truncatechars:200 }}</p>
                      {% endif %}
                      <div class="right">
                        <i class="fi-star vote-color"></i> Votez : &nbsp;
                        <a title="Ce document est très utile et mérite plus d'attention" class="label radius secondary"><i class="fi-like round-icon medium upvote "></i>&nbsp;0</a>
                        <a title="Ce document est décevant et/ou inintéressant pour le cours" class="label radius secondary"><i class="fi-dislike round-icon medium downvote "></i>&nbsp;0</a>
                      </div>
                      <div class="course-content-last-line">
                        <i class="fi-page-filled"></i>  {{ document.pages }} page{{ document.pages|pluralize }}
                        <i class="fi-clock"></i> Uploadé le {{ document.date|date:"d F Y" }}
                        {% if document.tags.all %}<i class="fi-pricetag-multiple"></i> {% endif %}
                        {% for kw in document.tags.all%}
                          <a data-id="{{kw.id}}" href="#"
                             style="background-color: {{kw.color}}; border: solid 2px {{kw.color}};"
                             class="radius label tag-item">
                            {{kw}}
                          </a>
                        {% endfor %}
                      </div>
                   </div>
                </div>
             </div>
             {% empty %}
               <h3>Il n’y a encore rien dans ce cours…</h3>
               <p>Personne n’est encore passé ici on dirait.<br>
                 Vous pourriez poser une question ou encore uploader un document en cliquant sur les boutons ci-dessus. </p>
             {% endfor %}

          </div>
        </div>
    </div>
</div>
{% endblock %}
